groups:
- name: api-"alert-rules.yml"
  rules:

  - alert: HighErrorRate
    expr: |
      sum(rate(http_requests_total{status=~"5.."}[1m])) /
            sum(rate(http_requests_total[1m])) > 0.2
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "High error rate detected"
      description: "The error rate has exceeded 20% for more than 30 seconds."

  - alert: LatencyP95
    expr: |
      histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[1m])) by (le)) > 1.5
    for: 30s
    labels:
      severity: warning
    annotations:
      summary: "High latency detected"
      description: "The 95th percentile latency has exceeded 1.5 seconds for more than 30 seconds."

  - alert: InstanceDown
    expr: up{job=""fastapi-app"} == 0
    for: 10s
    labels:
      severity: critical
    annotations:
      summary: "Instance down"
      description: "The API instance is down for more than 10 seconds."