name: python server test
on:
    push:
        branches:
            - main
            - "releases/*"
        paths:
            - "server-python/**"
    pull_request:
        branches:
            - "*"
        paths:
            - "server-python/**"
jobs:
    test:
        runs-on: ubuntu-latest
        defaults:
            run:
                working-directory: server-python
        steps:
            - name: Checkout repository
              uses: actions/checkout@v5
            - name: Install uv
              uses: astral-sh/setup-uv@v7
              with:
                  enable-cache: true
            - name: Setup Python
              run: uv python install
            - name: Install the project
              run: uv sync --locked --all-extras --dev
            - name: Run lint checks
              run: uv run ruff check --output-format=github
            - name: Run format checks
              run: uv run ruff format --check --diff
            - name: Run tests
              run: uv run pytest
